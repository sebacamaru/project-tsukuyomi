import{c as e}from"./index-BVPkigdB.js";import{t}from"./Scene-DWmEMtPM.js";var n=`<div class="incubator-spr__incubator"></div>
<div data-entity="egg" class="incubator-spr__egg"></div>
<div class="incubator-div__indicator">
    <div class="wrapper">
        <div data-entity="actionSlider" class="srp__actions"></div>
        <div data-entity="charging" class="srp__charging"></div>
        <div class="srp__mask"></div>
    </div>
</div>
<div data-entity="button" class="incubator-spr__button"></div>
`,r=class{constructor(e,{itemWidth:t,itemCount:n,scaleFn:r,onSnap:i,initialIndex:a=0,hitArea:o}){this._el=e,this._hitEl=this._createHitArea(e,o),this._itemW=t,this._count=n,this._totalW=t*n,this._scaleFn=r||(()=>1),this._onSnap=i||(()=>{}),this._pos=0,this._velocity=0,this._dragging=!1,this._lastX=0,this._lastTime=0,this._rafId=null,this._friction=.93,this._snapSpeed=.18,this._snapEpsilon=.15,this._velThreshold=.008,this._onDown=e=>this._pointerDown(e),this._onMove=e=>this._pointerMove(e),this._onUp=e=>this._pointerUp(e),this._disabled=!1,this._hitEl.addEventListener(`pointerdown`,this._onDown),this._hitEl.addEventListener(`pointermove`,this._onMove),this._hitEl.addEventListener(`pointerup`,this._onUp),this._hitEl.addEventListener(`pointercancel`,this._onUp),this.setIndex(a)}getCurrentIndex(){let e=this._wrap(this._pos);return(Math.round(e/this._itemW)%this._count+this._count)%this._count}setIndex(e){this._cancelRaf(),this._pos=e*this._itemW,this._velocity=0,this._apply()}goToIndex(e){this._cancelRaf(),this._velocity=0,this._snapTo(e*this._itemW)}disable(){this._disabled=!0,this._cancelRaf(),this._dragging&&this._hitEl&&(this._dragging=!1)}enable(){this._disabled=!1}destroy(){this._cancelRaf(),this._hitEl&&=(this._hitEl.removeEventListener(`pointerdown`,this._onDown),this._hitEl.removeEventListener(`pointermove`,this._onMove),this._hitEl.removeEventListener(`pointerup`,this._onUp),this._hitEl.removeEventListener(`pointercancel`,this._onUp),this._hitEl!==this._el&&this._hitEl.parentNode&&this._hitEl.parentNode.removeChild(this._hitEl),this._el=null,null)}_pointerDown(e){this._disabled||this._dragging||(this._hitEl.setPointerCapture(e.pointerId),this._dragging=!0,this._velocity=0,this._lastX=e.clientX,this._lastTime=performance.now(),this._cancelRaf())}_pointerMove(e){if(!this._dragging)return;let t=performance.now(),n=t-this._lastTime,r=this._scaleFn(),i=(e.clientX-this._lastX)/r;this._pos-=i,n>0&&(this._velocity=-i/n),this._lastX=e.clientX,this._lastTime=t,this._apply()}_pointerUp(e){this._dragging&&(this._dragging=!1,this._hitEl.releasePointerCapture(e.pointerId),this._startInertia())}_startInertia(){this._lastFrame=performance.now(),this._tick()}_tick(){if(this._dragging)return;let e=performance.now(),t=e-this._lastFrame;if(this._lastFrame=e,this._pos+=this._velocity*t,this._velocity*=this._friction**(t/16.67),Math.abs(this._velocity)<this._velThreshold){let e=Math.round(this._wrap(this._pos)/this._itemW)*this._itemW;this._snapTo(e);return}this._apply(),this._rafId=requestAnimationFrame(()=>this._tick())}_snapTo(e){let t=this._wrap(this._pos),n=e-t;Math.abs(n)>this._totalW/2&&(n-=Math.sign(n)*this._totalW);let r=this._pos+(e-t)+(n-(e-t)),i=()=>{if(this._dragging)return;let e=r-this._pos;if(Math.abs(e)<this._snapEpsilon){this._pos=r,this._velocity=0,this._apply(),this._onSnap(this.getCurrentIndex());return}this._pos+=e*this._snapSpeed,this._apply(),this._rafId=requestAnimationFrame(i)};this._rafId=requestAnimationFrame(i)}_createHitArea(e,t){if(!t)return e;let n=document.createElement(`div`);return n.style.cssText=`
      position: absolute;
      left: ${t.left}px;
      top: ${t.top}px;
      width: ${t.width}px;
      height: ${t.height}px;
      touch-action: none;
      cursor: grab;
    `,(e.parentNode.parentNode||e.parentNode).appendChild(n),n}_wrap(e){return(e%this._totalW+this._totalW)%this._totalW}_apply(){this._pos=this._wrap(this._pos),this._el.style.backgroundPositionX=`${-this._pos}px`}_cancelRaf(){this._rafId&&=(cancelAnimationFrame(this._rafId),null)}},i=class extends t{constructor(){super(),this.backgroundClass=`incubator-background`,this.currentEgg=null}async getSpriteHTML(){return n}async initUI(){await this.loadEgg(),this.entity.button.onClick(()=>this.onButtonPress()),this._actionSwiper=new r(this.entity.actionSlider.el,{itemWidth:24,itemCount:4,scaleFn:()=>this._spriteScale||1,onSnap:e=>this.onActionSelected(e),hitArea:{left:-20,top:-15,width:64,height:32}})}onExit(){this._actionSwiper?.destroy(),this._actionSwiper=null,super.onExit()}onActionSelected(e){console.log(`Action selected: ${e} (${[`HUMIDIFY`,`DRY`,`COLD`,`HEAT`][e]||`unknown`})`)}async loadEgg(){await e.getUserEggs(`incubating`),this.currentEgg=e.getIncubatingEggs()[0]||null}async onButtonPress(){await this.runSequence([()=>console.log(`holis1`),()=>this.entity.button.play(`anim-press`),()=>{console.log(`holis2`),this._actionSwiper.disable(),this.entity.charging.start(`anim-fade-in`),this.entity.button.addClass(`pressed`)},()=>this.shakeEgg(3)])}async shakeEgg(e){}};export{i as IncubatorScene};