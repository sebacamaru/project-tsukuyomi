const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./MessageBox-BgjNrUsi.js","./MessageBox-B-ocjRWL.js"])))=>i.map(i=>d[i]);
import{d as e,f as t,u as n}from"./index-zi4sCZYj.js";function r(e){let t=e.getBoundingClientRect();return t.top<window.innerHeight+200&&t.bottom>-200&&t.left<window.innerWidth+200&&t.right>-200}function i(e){e.src=e.dataset.src,e.complete?e.classList.remove(`lazy`):(e.onload=()=>e.classList.remove(`lazy`),e.onerror=()=>e.classList.remove(`lazy`))}function a(e=document){let t=Array.from(e.querySelectorAll(`img.lazy`));if(!(`IntersectionObserver`in window)){t.forEach(i);return}let n=new IntersectionObserver(e=>{for(let t of e)t.isIntersecting&&(i(t.target),n.unobserve(t.target))},{root:null,rootMargin:`200px`});t.forEach(e=>{r(e)?i(e):n.observe(e)})}var o=class{constructor(e,t){this.el=e,this._stopFn=null,this._scene=t}async play(e){return this._stopFn&&this.stop(),this._scene.playAnim(this.el,e)}start(e){return this._stopFn&&this.stop(),this._stopFn=this._scene.startAnim(this.el,e),this}stop(){return this._stopFn&&=(this._stopFn(),null),this}show(){return this.el.hidden=!1,this}hide(){return this.el.hidden=!0,this}addClass(e){return this.el.classList.add(e),this}removeClass(e){return this.el.classList.remove(e),this}toggle(e){return this.el.classList.toggle(e),this}onClick(e){return this._scene.on(this.el,`click`,e),this}on(e,t){return this._scene.on(this.el,e,t),this}get disabled(){return this.el.disabled}set disabled(e){this.el.disabled=e}},s=class{constructor(e){this.items=e}async playAll(e){return Promise.all(this.items.map(t=>t.play(e)))}async playSequential(e,t=200){for(let n=0;n<this.items.length;n++)await this.items[n].play(e),n<this.items.length-1&&t>0&&await new Promise(e=>setTimeout(e,t))}each(e){return this.items.forEach(e),this}async eachSequential(e,t=200){for(let n=0;n<this.items.length;n++)await e(this.items[n],n),n<this.items.length-1&&t>0&&await new Promise(e=>setTimeout(e,t))}startAll(e){return this.items.forEach(t=>t.start(e)),this}stopAll(){return this.items.forEach(e=>e.stop()),this}},c=class{constructor(){this.root=null,this.entity={},this.entities={},this.eventHandlers=new Map,this.background=null,this.backgroundClass=null,this._originalBackground=null,this._cutsceneModeActive=!1,this.spriteRoot=null,this.uiRoot=null}async onEnter(e){this.root=e,this.backgroundClass&&e.classList.add(this.backgroundClass),this.background&&(this._originalBackground=e.style.background,e.style.background=this.background);let t=await this.getSpriteHTML();if(t){e.innerHTML=`
        <div id="sprite-renderer"></div>
        <div id="ui-renderer"></div>
      `,this.spriteRoot=e.querySelector(`#sprite-renderer`),this.uiRoot=e.querySelector(`#ui-renderer`),this.spriteRoot.innerHTML=t;let n=await this.getHTML();n&&(this.uiRoot.innerHTML=n),this._updateSpriteScale(),this._resizeHandler=()=>this._updateSpriteScale(),window.addEventListener(`resize`,this._resizeHandler)}else e.innerHTML=await this.getHTML();this._registerEntities(),await this.initUI(e),a(e),this.onEnterComplete().catch(e=>{console.error(`Error in onEnterComplete:`,e)})}onExit(){this._sequenceCancelled=!0,this._cutsceneModeActive&&this.exitCutsceneMode(),this.backgroundClass&&this.root&&this.root.classList.remove(this.backgroundClass),this.background&&this.root&&(this.root.style.background=this._originalBackground,this._originalBackground=null);for(let e of Object.values(this.entity))e.stop();this.entity={},this.entities={},this._resizeHandler&&=(window.removeEventListener(`resize`,this._resizeHandler),null),this.spriteRoot=null,this.uiRoot=null,this.eventHandlers.forEach(({element:e,event:t,handler:n})=>{e.removeEventListener(t,n)}),this.eventHandlers.clear(),this.root=null}on(e,t,n){e.addEventListener(t,n),this.eventHandlers.set(`${t}-${Math.random()}`,{element:e,event:t,handler:n})}$(e){return this.root.querySelector(e)}$$(e){return this.root.querySelectorAll(e)}onClick(e,t){this.on(this.root,`click`,n=>{let r=n.target.closest(e);r&&t(n,r)})}async getHTML(){return``}async getSpriteHTML(){return``}_updateSpriteScale(){if(!this.spriteRoot||!this.root)return;let e=Math.min(this.root.clientWidth/90,this.root.clientHeight/135);this.spriteRoot.style.transform=`translate(-50%, -50%) scale(${e})`}async initUI(e){}async onEnterComplete(){}delay(e){return new Promise(t=>setTimeout(t,e))}playAnim(e,t){return e.classList.remove(t),e.offsetWidth,new Promise(n=>{e.addEventListener(`animationend`,()=>{e.classList.remove(t),n()},{once:!0}),e.classList.add(t)})}startAnim(e,t){return e.classList.add(t),()=>e.classList.remove(t)}async runSequence(e){this._sequenceCancelled=!1;for(let t of e){if(this._sequenceCancelled)return;await t()}}enterCutsceneMode(){if(n===void 0){console.error(`Scene: SceneManager no disponible`);return}n._applyCutsceneMode(!0),this._cutsceneModeActive=!0,this._recalcSpriteAfterTransition()}exitCutsceneMode(){if(n===void 0){console.error(`Scene: SceneManager no disponible`);return}n._applyCutsceneMode(!1),this._cutsceneModeActive=!1,this._recalcSpriteAfterTransition()}_recalcSpriteAfterTransition(){if(!this.spriteRoot)return;let e=document.querySelector(`#navbar-container`);e&&e.addEventListener(`transitionend`,()=>this._updateSpriteScale(),{once:!0})}async withLoading(t){return e.wrap(t)}async showMessage(e,n=null){let{MessageBox:r}=await t(async()=>{let{MessageBox:e}=await import(`./MessageBox-BgjNrUsi.js`);return{MessageBox:e}},__vite__mapDeps([0,1]),import.meta.url);return r.alert(e,n)}async playSceneAnim(e){return this.playAnim(this.root,e)}_registerEntities(){this.entity={},this.entities={};for(let e of this.root.querySelectorAll(`[data-entity]`)){let t=e.dataset.entity;this.entity[t]||(this.entity[t]=new o(e,this))}let e={};for(let t of this.root.querySelectorAll(`[data-group]`)){let n=t.dataset.group;e[n]||(e[n]=[]),e[n].push(new o(t,this))}for(let[t,n]of Object.entries(e))this.entities[t]=new s(n)}};export{a as n,c as t};