const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./lib-Dxx_aztv.js","./Filter-BEjgMG_t.js","./DOMContainer-BHNsiAfU.js","./FilterSystem-DrHbQy25.js","./CanvasPool-CcMbyN3l.js","./SharedSystems-BiYNgiaQ.js","./WebGLRenderer-DMVCX7Hw.js","./WebGPURenderer-DyQmMnaz.js","./DashboardScene-AQUB28h-.js","./Scene-B0WgXyFJ.js","./DashboardScene-Dr1GV7uU.css","./MarketplaceScene-Xu6ydaXI.js","./assetRegistry-nONwpp3R.js","./MarketplaceScene-BywWVdPo.css","./ProfessorScene-Bgr80FAf.js","./ProfessorScene-GWLJh_VK.css","./LoginScene-Zr6u7SDk.js","./auth-B8qqHQR6.css","./RegisterScene-BPGeuAjV.js","./AdminScene-sr1B6xxi.js","./AdminScene-Dasy6RAS.css","./InventoryScene-DAejp0uF.js","./InventoryScene-BpnIsiWX.css"])))=>i.map(i=>d[i]);
(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();var e=`modulepreload`,t=function(e,t){return new URL(e,t).href},n={};const r=function(r,i,a){let o=Promise.resolve();if(i&&i.length>0){let r=document.getElementsByTagName(`link`),s=document.querySelector(`meta[property=csp-nonce]`),c=s?.nonce||s?.getAttribute(`nonce`);function l(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:`fulfilled`,value:e}),e=>({status:`rejected`,reason:e}))))}o=l(i.map(i=>{if(i=t(i,a),i in n)return;n[i]=!0;let o=i.endsWith(`.css`),s=o?`[rel="stylesheet"]`:``;if(a)for(let e=r.length-1;e>=0;e--){let t=r[e];if(t.href===i&&(!o||t.rel===`stylesheet`))return}else if(document.querySelector(`link[href="${i}"]${s}`))return;let l=document.createElement(`link`);if(l.rel=o?`stylesheet`:e,o||(l.as=`script`),l.crossOrigin=``,l.href=i,c&&l.setAttribute(`nonce`,c),document.head.appendChild(l),o)return new Promise((e,t)=>{l.addEventListener(`load`,e),l.addEventListener(`error`,()=>t(Error(`Unable to preload CSS for ${i}`)))})}))}function s(e){let t=new Event(`vite:preloadError`,{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return o.then(e=>{for(let t of e||[])t.status===`rejected`&&s(t.reason);return r().catch(s)})};var i=class{constructor(){this.app=null,this.particles=[],this.PIXI=null}async init(){return this.app?this.app:(this.PIXI||=await r(()=>import(`./lib-Dxx_aztv.js`),__vite__mapDeps([0,1,2,3,4,5,6,7]),import.meta.url),this.app=new this.PIXI.Application,await this.app.init({background:658983,resizeTo:window,antialias:!0}),this.app.canvas.style.position=`fixed`,this.app.canvas.style.top=`0`,this.app.canvas.style.left=`0`,this.app.canvas.style.zIndex=`-1`,this.app.canvas.style.width=`100%`,this.app.canvas.style.height=`100%`,document.body.prepend(this.app.canvas),this.createParticles(),this.app.ticker.add(()=>this.animate()),this.app)}createParticles(){for(let e=0;e<25;e++){let e=new this.PIXI.Graphics,t=Math.random()*64+1,n=[3447003,3066993,10181046,15965202][Math.floor(Math.random()*4)];e.circle(0,0,t),e.fill({color:n,alpha:.6});let r={graphics:e,x:Math.random()*window.innerWidth,y:Math.random()*window.innerHeight,vx:(Math.random()-.5)*.5,vy:(Math.random()-.5)*.5,size:t};e.x=r.x,e.y=r.y,this.app.stage.addChild(e),this.particles.push(r)}}animate(){this.particles.forEach(e=>{e.x+=e.vx,e.y+=e.vy,e.x<0&&(e.x=window.innerWidth),e.x>window.innerWidth&&(e.x=0),e.y<0&&(e.y=window.innerHeight),e.y>window.innerHeight&&(e.y=0),e.graphics.x=e.x,e.graphics.y=e.y})}destroy(){this.app&&=(this.app.destroy(!0),null)}};const a=new class{constructor(){this.element=null,this.progressBar=null,this.loadingQueue=0,this.init()}init(){this.element=document.createElement(`div`),this.element.className=`loading-indicator`,this.element.innerHTML=`
      <div class="loading-indicator__bar"></div>
    `,document.body.appendChild(this.element),this.progressBar=this.element.querySelector(`.loading-indicator__bar`)}show(){this.loadingQueue++,this.loadingQueue===1&&(this.element.classList.add(`loading-indicator--visible`),this.progressBar.style.width=`0%`,setTimeout(()=>{this.progressBar.style.width=`99%`},100))}hide(){this.loadingQueue=Math.max(0,this.loadingQueue-1),this.loadingQueue===0&&(this.element.classList.remove(`loading-indicator--visible`),setTimeout(()=>{this.progressBar.style.width=`0%`},200))}async wrap(e){this.show();try{return await e()}finally{this.hide()}}},o={scenes:new Map,instances:new Map,current:null,container:null,router:null,cutsceneMode:!1,init(e,t=null){this.container=e,this.router=t},register(e,t,n=null){if(this.scenes.set(e,t),this.router){let t=n||this.generatePath(e);this.router.register(t,e)}},generatePath(e){return e===`dashboard`||e===`home`?`/`:{market:`/marketplace`}[e]||`/${e}`},async goTo(e,t=!0){a.show();try{let n=this.scenes.get(e);if(!n)throw Error(`Scene not found: `+e);let r=n;if(typeof n==`function`&&!n.prototype){let e=await n();r=e.default||Object.values(e)[0]}let i=this.instances.get(e);if(i||(i=new r,this.instances.set(e,i)),this.current&&this.current.onExit(),this.container.innerHTML=``,this.current=i,await i.onEnter(this.container),t&&this.router){let t=this.router.getPathByScene(e);t&&t!==this.router.currentPath&&window.history.pushState({},``,t)}}finally{a.hide()}},_applyCutsceneMode(e){this.cutsceneMode=e;let t=document.querySelector(`#navbar-container`),n=document.querySelector(`#scene-outlet`);if(!t){console.warn(`SceneManager: #navbar-container no encontrado`);return}e?(t.classList.add(`navbar-container--hidden`),n&&n.classList.add(`cutscene-mode`)):(t.classList.remove(`navbar-container--hidden`),n&&n.classList.remove(`cutscene-mode`))}},s={gold:0,inventory:[],items:[],user:null,token:null};var c=`/api`;const l={async loadInventory(){if(!s.user?.id)return{inventory:[],gold:0};try{let e=await fetch(`${c}/users/${s.user.id}/inventory`,{headers:p()});if(!e.ok)throw Error(`Failed to fetch inventory`);let t=await e.json();return s.inventory=t.inventory,s.gold=t.gold,t}catch(e){return console.error(`Error loading inventory:`,e),{inventory:s.inventory,gold:s.gold}}},async buyItem(e,t=1){try{let n=await fetch(`${c}/marketplace/buy`,{method:`POST`,headers:p(),body:JSON.stringify({userId:s.user.id,itemId:e,quantity:t})}),r=await n.json();return n.ok&&r.success?(s.gold=r.newGold,await this.loadInventory(),{success:!0,...r}):{success:!1,error:r.error}}catch(e){return console.error(`Error buying item:`,e),{success:!1,error:`Error de conexi贸n`}}},getItemsByType(e){return s.inventory.filter(t=>t.type===e)},hasItem(e){return s.inventory.some(t=>t.item_id===e&&t.quantity>0)},getItemQuantity(e){return s.inventory.filter(t=>t.item_id===e).reduce((e,t)=>e+t.quantity,0)},getItemInstances(e){return s.inventory.filter(t=>t.item_id===e)}};var u=`/auth`,d=`tsukuyomi_auth`;const f={async login(e,t){try{let n=await fetch(`${u}/login`,{method:`POST`,headers:{"Content-Type":`application/json`},body:JSON.stringify({email:e,password:t})}),r=await n.json();return n.ok?(this._saveSession(r.token,r.user),await l.loadInventory(),{success:!0}):{success:!1,error:r.error||`Error al iniciar sesi贸n`}}catch(e){return console.error(`Login error:`,e),{success:!1,error:`Error de conexi贸n`}}},async register(e,t){try{let n=await fetch(`${u}/register`,{method:`POST`,headers:{"Content-Type":`application/json`},body:JSON.stringify({email:e,password:t})}),r=await n.json();return n.ok?(this._saveSession(r.token,r.user),await l.loadInventory(),{success:!0}):{success:!1,error:r.error||`Error al registrarse`}}catch(e){return console.error(`Register error:`,e),{success:!1,error:`Error de conexi贸n`}}},logout(){s.token=null,s.user=null,s.gold=0,s.inventory=[],localStorage.removeItem(d)},restoreSession(){try{let e=localStorage.getItem(d);if(!e)return;let{token:t,user:n}=JSON.parse(e);t&&n&&(s.token=t,s.user=n,l.loadInventory())}catch(e){console.error(`Error restoring session:`,e),localStorage.removeItem(d)}},isAuthenticated(){return!!s.token&&!!s.user},updateSession(){s.token&&s.user&&localStorage.setItem(d,JSON.stringify({token:s.token,user:s.user}))},getToken(){return s.token},_saveSession(e,t){s.token=e,s.user=t,localStorage.setItem(d,JSON.stringify({token:e,user:t})),y&&y.updateProfessorBadge()}};function p(){let e={"Content-Type":`application/json`};return s.token&&(e.Authorization=`Bearer ${s.token}`),e}var m=[`/login`,`/register`];const h=new class{constructor(){this.routes=new Map,this.sceneToPath=new Map,this.sceneManager=null}init(e){this.sceneManager=e,window.addEventListener(`popstate`,()=>{this.handleRoute(window.location.pathname)}),document.addEventListener(`click`,e=>{let t=e.target.closest(`a[href^='/']`);t&&(e.preventDefault(),this.navigate(t.getAttribute(`href`)))}),this.handleRoute(window.location.pathname)}register(e,t){this.routes.set(e,t),this.sceneToPath.set(t,e)}navigate(e){window.history.pushState({},``,e),this.handleRoute(e)}handleRoute(e){if(!m.includes(e)&&!f.isAuthenticated()){this.navigate(`/login`);return}if(m.includes(e)&&f.isAuthenticated()){this.navigate(`/`);return}let t=this.routes.get(e);t?this.sceneManager.goTo(t,!1):(console.warn(`Route not found: ${e}, redirecting to /`),this.navigate(`/`))}getPathByScene(e){return this.sceneToPath.get(e)}get currentPath(){return window.location.pathname}};var g=class{constructor(e=[]){this.items=e,this.currentRoute=window.location.pathname}render(){let e=document.createElement(`nav`);e.className=`navbar`,e.id=`main-nav`;let t=this.items.find(e=>this.isActive(e.route))||this.items[0],n=document.createElement(`div`);n.className=`navbar__title`,n.innerHTML=`<h1>${t.label}</h1>`;let r=document.createElement(`div`);return r.className=`navbar__container`,this.items.forEach(e=>{let t=this.createNavItem(e);r.appendChild(t)}),e.appendChild(n),e.appendChild(r),e}createNavItem(e){let t=document.createElement(`a`);t.href=e.route,t.className=`navbar__item`,t.dataset.route=e.route,this.isActive(e.route)&&t.classList.add(`navbar__item--active`);let n=e.badge&&e.badge>0?`<span class="navbar__badge">${e.badge>99?`99+`:e.badge}</span>`:``;return t.innerHTML=`
      <div class="navbar__icon">
        ${e.icon}
      </div>
      <span class="navbar__label">${e.label}</span>
      ${n}
    `,t.addEventListener(`click`,t=>{t.preventDefault(),this.navigate(e.route)}),t}isActive(e){return e===`/`?this.currentRoute===`/`:this.currentRoute.startsWith(e)}navigate(e){this.currentRoute=e,document.querySelectorAll(`.navbar__item`).forEach(e=>{let t=e.dataset.route;this.isActive(t)?e.classList.add(`navbar__item--active`):e.classList.remove(`navbar__item--active`)});let t=this.items.find(e=>this.isActive(e.route));if(t){let e=document.querySelector(`.navbar__title h1`);e&&(e.textContent=t.label)}window.dispatchEvent(new CustomEvent(`navigate`,{detail:{route:e}}))}updateItems(e){this.items=e;let t=document.querySelector(`#main-nav`);if(t){let e=this.render();t.replaceWith(e)}}updateBadge(e,t){let n=this.items.find(t=>t.route===e);n&&(n.badge=t);let r=document.querySelector(`.navbar__item[data-route="${e}"]`);if(r){let e=r.querySelector(`.navbar__badge`);if(t>0){let n=t>99?`99+`:t;e?e.textContent=n:(e=document.createElement(`span`),e.className=`navbar__badge`,e.textContent=n,r.appendChild(e))}else e&&e.remove()}}static renderHTML(e=[],t=`/`){let n=e.find(e=>e.route===`/`?t===`/`:t.startsWith(e.route))||e[0],r=e.map(e=>{let n=(e.route===`/`?t===`/`:t.startsWith(e.route))?` navbar__item--active`:``,r=e.badge&&e.badge>0?`<span class="navbar__badge">${e.badge>99?`99+`:e.badge}</span>`:``;return`
        <a href="${e.route}" class="navbar__item${n}" data-route="${e.route}">
          <div class="navbar__icon">
            ${e.icon}
          </div>
          <span class="navbar__label">${e.label}</span>
          ${r}
        </a>
      `}).join(``);return`
      <nav class="navbar" id="main-nav">
        <div class="navbar__title">
          <h1>${n?n.label:`Navbar`}</h1>
        </div>
        <div class="navbar__container">
          ${r}
        </div>
      </nav>
    `}},_=`<div id="app-layout">
    <main id="scene-outlet"></main>

    <div id="navbar-container"></div>
</div>
`,v=class{constructor(){this.renderer=new i}async init(){await a.wrap(async()=>{await this.renderer.init()});let e=document.createElement(`div`);e.id=`ui-root`,e.innerHTML=_,document.body.appendChild(e);let t=e.querySelector(`#scene-outlet`);o.init(t,h),this.initNavbar(e),this.scheduleBadgeUpdate()}getProfessorBadge(){let e=s.user;return!e||!e.current_quest_code||e.next_quest_available_at&&Math.floor(Date.now()/1e3)<e.next_quest_available_at?0:1}initNavbar(e){this.navbar=new g([{route:`/`,label:`Inicio`,icon:``},{route:`/inventory`,label:`Inventario`,icon:``},{route:`/professor`,label:`Profesor Cacho`,icon:`ゼ`,badge:this.getProfessorBadge()},{route:`/marketplace`,label:`Marketplace`,icon:``},{route:`/profile`,label:`Perfil`,icon:``}]),e.querySelector(`#navbar-container`).appendChild(this.navbar.render())}updateProfessorBadge(){this.navbar&&this.navbar.updateBadge(`/professor`,this.getProfessorBadge()),this.scheduleBadgeUpdate()}scheduleBadgeUpdate(){this.badgeTimer&&=(clearTimeout(this.badgeTimer),null);let e=s.user;if(!e||!e.next_quest_available_at||!e.current_quest_code)return;let t=Math.floor(Date.now()/1e3),n=e.next_quest_available_at-t;n>0&&(this.badgeTimer=setTimeout(()=>{this.updateProfessorBadge()},n*1e3))}};let y=null;async function b(){y=new v,f.restoreSession(),await y.init(),o.register(`dashboard`,()=>r(()=>import(`./DashboardScene-AQUB28h-.js`),__vite__mapDeps([8,9,10]),import.meta.url)),o.register(`market`,()=>r(()=>import(`./MarketplaceScene-Xu6ydaXI.js`),__vite__mapDeps([11,12,9,13]),import.meta.url)),o.register(`professor`,()=>r(()=>import(`./ProfessorScene-Bgr80FAf.js`),__vite__mapDeps([14,9,15]),import.meta.url)),o.register(`login`,()=>r(()=>import(`./LoginScene-Zr6u7SDk.js`),__vite__mapDeps([16,9,17]),import.meta.url),`/login`),o.register(`register`,()=>r(()=>import(`./RegisterScene-BPGeuAjV.js`),__vite__mapDeps([18,9,17]),import.meta.url),`/register`),o.register(`admin`,()=>r(()=>import(`./AdminScene-sr1B6xxi.js`),__vite__mapDeps([19,12,9,20]),import.meta.url),`/admin`),o.register(`inventory`,()=>r(()=>import(`./InventoryScene-DAejp0uF.js`),__vite__mapDeps([21,12,9,22]),import.meta.url)),h.init(o)}b();export{l as a,a as c,p as i,r as l,h as n,s as o,f as r,o as s,y as t};