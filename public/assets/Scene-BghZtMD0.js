import{d as e,u as t}from"./index-wKzs5zvE.js";function n(e){let t=e.getBoundingClientRect();return t.top<window.innerHeight+200&&t.bottom>-200&&t.left<window.innerWidth+200&&t.right>-200}function r(e){e.src=e.dataset.src,e.complete?e.classList.remove(`lazy`):(e.onload=()=>e.classList.remove(`lazy`),e.onerror=()=>e.classList.remove(`lazy`))}function i(e=document){let t=Array.from(e.querySelectorAll(`img.lazy`));if(!(`IntersectionObserver`in window)){t.forEach(r);return}let i=new IntersectionObserver(e=>{for(let t of e)t.isIntersecting&&(r(t.target),i.unobserve(t.target))},{root:null,rootMargin:`200px`});t.forEach(e=>{n(e)?r(e):i.observe(e)})}var a=class{constructor(){this.root=null,this.eventHandlers=new Map,this.background=null,this.backgroundClass=null,this._originalBackground=null,this._cutsceneModeActive=!1}async onEnter(e){this.root=e,this.backgroundClass&&e.classList.add(this.backgroundClass),this.background&&(this._originalBackground=e.style.background,e.style.background=this.background),e.innerHTML=await this.getHTML(),await this.initUI(e),i(e),this.onEnterComplete().catch(e=>{console.error(`Error in onEnterComplete:`,e)})}onExit(){this._cutsceneModeActive&&this.exitCutsceneMode(),this.backgroundClass&&this.root&&this.root.classList.remove(this.backgroundClass),this.background&&this.root&&(this.root.style.background=this._originalBackground,this._originalBackground=null),this.eventHandlers.forEach(({element:e,event:t,handler:n})=>{e.removeEventListener(t,n)}),this.eventHandlers.clear(),this.root=null}on(e,t,n){e.addEventListener(t,n),this.eventHandlers.set(`${t}-${Math.random()}`,{element:e,event:t,handler:n})}$(e){return this.root.querySelector(e)}$$(e){return this.root.querySelectorAll(e)}onClick(e,t){this.on(this.root,`click`,n=>{let r=n.target.closest(e);r&&t(n,r)})}async getHTML(){throw Error(`getHTML() must be implemented by subclass`)}async initUI(e){}async onEnterComplete(){}delay(e){return new Promise(t=>setTimeout(t,e))}enterCutsceneMode(){if(t===void 0){console.error(`Scene: SceneManager no disponible`);return}t._applyCutsceneMode(!0),this._cutsceneModeActive=!0}exitCutsceneMode(){if(t===void 0){console.error(`Scene: SceneManager no disponible`);return}t._applyCutsceneMode(!1),this._cutsceneModeActive=!1}async withLoading(t){return e.wrap(t)}};export{i as n,a as t};