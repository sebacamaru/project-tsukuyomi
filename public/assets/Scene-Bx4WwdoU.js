import{a as e,o as t}from"./index-Do9XzL4n.js";function n(e=document){let t=Array.from(e.querySelectorAll(`img.lazy`));if(!(`IntersectionObserver`in window)){t.forEach(e=>e.src=e.dataset.src);return}let n=new IntersectionObserver(e=>{for(let t of e)if(t.isIntersecting){let e=t.target;e.src=e.dataset.src,e.classList.remove(`lazy`),n.unobserve(e)}},{root:e,rootMargin:`200px`});t.forEach(e=>n.observe(e))}var r=class{constructor(){this.root=null,this.eventHandlers=new Map,this.background=null,this.backgroundClass=null,this._originalBackground=null,this._cutsceneModeActive=!1}async onEnter(e){this.root=e,this.backgroundClass&&e.classList.add(this.backgroundClass),this.background&&(this._originalBackground=e.style.background,e.style.background=this.background),e.innerHTML=await this.getHTML(),n(e),await this.initUI(e),this.onEnterComplete().catch(e=>{console.error(`Error in onEnterComplete:`,e)})}onExit(){this._cutsceneModeActive&&this.exitCutsceneMode(),this.backgroundClass&&this.root&&this.root.classList.remove(this.backgroundClass),this.background&&this.root&&(this.root.style.background=this._originalBackground,this._originalBackground=null),this.eventHandlers.forEach(({element:e,event:t,handler:n})=>{e.removeEventListener(t,n)}),this.eventHandlers.clear(),this.root=null}on(e,t,n){e.addEventListener(t,n),this.eventHandlers.set(`${t}-${Math.random()}`,{element:e,event:t,handler:n})}$(e){return this.root.querySelector(e)}$$(e){return this.root.querySelectorAll(e)}onClick(e,t){this.on(this.root,`click`,n=>{let r=n.target.closest(e);r&&t(n,r)})}async getHTML(){throw Error(`getHTML() must be implemented by subclass`)}async initUI(e){}async onEnterComplete(){}delay(e){return new Promise(t=>setTimeout(t,e))}enterCutsceneMode(){if(e===void 0){console.error(`Scene: SceneManager no disponible`);return}e._applyCutsceneMode(!0),this._cutsceneModeActive=!0}exitCutsceneMode(){if(e===void 0){console.error(`Scene: SceneManager no disponible`);return}e._applyCutsceneMode(!1),this._cutsceneModeActive=!1}async withLoading(e){return t.wrap(e)}};export{r as t};